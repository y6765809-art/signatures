<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×–×¨×™××” ×¤×œ×•×¡ - ××¢×¨×›×ª ×—×ª×™××•×ª ×“×™×’×™×˜×œ×™×•×ª</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --gold-primary: #D4AF37;
            --gold-light: #FFD700;
            --success: #2ECC71;
            --whatsapp: #25D366;
            --danger: #E74C3C;
            --dark: #1A1A1A;
            --white: #FFFFFF;
        }
        
        body {
            font-family: 'Heebo', sans-serif;
            background: linear-gradient(135deg, #1A1A1A 0%, #2C2C2C 50%, #1A1A1A 100%);
            min-height: 100vh;
            padding: 15px;
            direction: rtl;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, var(--dark) 0%, #2C2C2C 100%);
            border-radius: 12px;
            padding: 20px 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid var(--gold-primary);
        }
        
        .logo {
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--gold-light), var(--gold-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .slogan {
            font-size: 14px;
            color: #F5E6D3;
            font-style: italic;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 20px;
            max-height: calc(100vh - 170px);
        }
        
        .left-panel, .right-panel {
            background: linear-gradient(to bottom, var(--white), #f8f8f8);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            border: 2px solid var(--gold-primary);
            overflow-y: auto;
            max-height: calc(100vh - 170px);
        }
        
        .panel-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--dark);
            padding-bottom: 12px;
            border-bottom: 3px solid var(--gold-primary);
        }
        
        .upload-zone {
            border: 3px dashed var(--gold-primary);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: linear-gradient(135deg, #F5E6D3, #fff);
        }
        
        .upload-zone:hover {
            border-color: var(--gold-light);
            transform: translateY(-2px);
        }
        
        .pdf-viewer {
            display: none;
            margin-top: 20px;
        }
        
        .pdf-controls {
            background: linear-gradient(135deg, var(--dark), #2C2C2C);
            padding: 12px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            border: 2px solid var(--gold-primary);
            border-bottom: none;
        }
        
        .pdf-info {
            color: var(--gold-light);
            font-size: 14px;
            font-weight: 700;
        }
        
        .pdf-image-container {
            position: relative;
            border: 2px solid var(--gold-primary);
            border-radius: 0 0 10px 10px;
            overflow: auto;
            max-height: calc(100vh - 380px);
            background: #f5f5f5;
            text-align: center;
            padding: 20px;
        }
        
        #pdfImage {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .field-types {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .field-btn {
            padding: 14px;
            border: 2px solid var(--gold-primary);
            background: linear-gradient(135deg, #F5E6D3, #fff);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 700;
            color: var(--dark);
        }
        
        .field-btn:hover {
            background: linear-gradient(135deg, var(--gold-primary), var(--gold-light));
            transform: translateY(-2px);
        }
        
        .field-btn.active {
            background: linear-gradient(135deg, var(--gold-primary), var(--gold-light));
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.2);
        }
        
        .field-marker {
            position: absolute;
            border: 3px solid;
            background: rgba(212, 175, 55, 0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 13px;
            color: var(--dark);
            cursor: move;
            user-select: none;
            text-shadow: 0 0 4px white;
        }
        
        .field-marker:hover {
            border-width: 4px;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }
        
        .resize-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--gold-primary);
            border: 2px solid white;
            border-radius: 50%;
            bottom: -6px;
            right: -6px;
            cursor: se-resize;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 700;
            font-size: 14px;
            color: var(--dark);
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Heebo', sans-serif;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--gold-primary);
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 90px;
        }
        
        .collapsible-section {
            margin-top: 10px;
        }
        
        .collapsible-header {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border: 2px solid #2196F3;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 700;
            color: #0D47A1;
            display: flex;
            justify-content: space-between;
            transition: all 0.3s;
        }
        
        .collapsible-header:hover {
            background: linear-gradient(135deg, #bbdefb, #90caf9);
        }
        
        .collapsible-content {
            display: none;
            background: #f0f8ff;
            border: 2px solid #2196F3;
            border-top: none;
            border-radius: 0 0 8px 8px;
            padding: 12px;
            font-size: 12px;
            color: #1565C0;
            line-height: 1.6;
        }
        
        .collapsible-content.active {
            display: block;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            font-size: 14px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--gold-primary), var(--gold-light));
            color: var(--dark);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(212, 175, 55, 0.5);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
        }
        
        .btn-whatsapp {
            background: linear-gradient(135deg, var(--whatsapp), #128C7E);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #c0392b);
            color: white;
        }
        
        .btn-small {
            padding: 8px 14px;
            font-size: 12px;
        }
        
        .btn-block {
            width: 100%;
        }
        
        /* âœ… ×›×¤×ª×•×¨×™× ×›××• ×‘×ª××•× ×” */
        .send-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .send-buttons .btn {
            flex: 1;
            padding: 14px;
            font-size: 15px;
            font-weight: 800;
        }
        
        .link-box {
            background: #f9f9f9;
            border: 2px solid var(--gold-primary);
            border-radius: 8px;
            padding: 12px;
        }
        
        .link-label {
            font-size: 11px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 6px;
        }
        
        .alert {
            padding: 14px;
            border-radius: 8px;
            margin-bottom: 18px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 2px solid #856404;
            color: #856404;
        }
        
        .hidden {
            display: none !important;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <div class="logo">âœ¨ ×–×¨×™××” ×¤×œ×•×¡</div>
                <div class="slogan">×ª×Ÿ ×œ×›×¡×£ ×©×œ×š ×œ×–×¨×•×</div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="panel-title">ğŸ“„ ××¡××š PDF</div>
                
                <div class="upload-zone" id="uploadZone">
                    <div style="font-size: 60px; margin-bottom: 15px;">ğŸ“¤</div>
                    <div style="font-size: 18px; margin-bottom: 10px; font-weight: 700;">×’×¨×•×¨ ×§×•×‘×¥ PDF ×œ×›××Ÿ ××• ×œ×—×¥ ×œ×‘×—×™×¨×”</div>
                    <div style="font-size: 13px; color: #666;">×’×•×“×œ ××§×¡×™××œ×™: 50MB</div>
                    <input type="file" id="fileInput" accept="application/pdf" style="display: none;">
                </div>
                
                <div class="pdf-viewer" id="pdfViewer">
                    <div class="pdf-controls">
                        <div class="pdf-info">
                            ğŸ“„ <span id="fileName">××¡××š</span> | 
                            ğŸ“Š ×¢××•×“ <span id="pageNum">1</span>/<span id="totalPages">1</span>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-small btn-primary" onclick="previousPage()" id="prevBtn" disabled>â—€</button>
                            <button class="btn btn-small btn-primary" onclick="nextPage()" id="nextBtn" disabled>â–¶</button>
                            <button class="btn btn-small btn-danger" onclick="removeFile()">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <div class="pdf-image-container" id="imageContainer">
                        <img id="pdfImage" src="" alt="PDF">
                    </div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="panel-title">âœï¸ ×¡×•×’×™ ×©×“×•×ª</div>
                
                <div class="field-types">
                    <button class="field-btn" data-field="signature">
                        <span style="font-size: 20px;">âœï¸</span>
                        <span>×—×ª×™××”</span>
                    </button>
                    <button class="field-btn" data-field="name">
                        <span style="font-size: 20px;">ğŸ‘¤</span>
                        <span>×©× ××œ×</span>
                    </button>
                    <button class="field-btn" data-field="email">
                        <span style="font-size: 20px;">ğŸ“§</span>
                        <span>××™×™×œ</span>
                    </button>
                    <button class="field-btn" data-field="phone">
                        <span style="font-size: 20px;">ğŸ“±</span>
                        <span>×˜×œ×¤×•×Ÿ</span>
                    </button>
                    <button class="field-btn" data-field="idNumber">
                        <span style="font-size: 20px;">ğŸ†”</span>
                        <span>×ª.×–</span>
                    </button>
                    <button class="field-btn" data-field="date">
                        <span style="font-size: 20px;">ğŸ“…</span>
                        <span>×ª××¨×™×š</span>
                    </button>
                    <button class="field-btn" data-field="custom">
                        <span style="font-size: 20px;">ğŸ“</span>
                        <span>×˜×§×¡×˜ ×—×•×¤×©×™</span>
                    </button>
                </div>
                
                <div class="alert alert-warning">
                    ğŸ’¡ ×‘×—×¨ ×©×“×” ×•×œ×—×¥ ×¢×œ ×”×ª××•× ×”
                </div>
                
                <div class="panel-title" style="margin-top: 20px;">
                    ğŸ“‹ ×©×“×•×ª (<span id="fieldCount">0</span>)
                </div>
                
                <div id="fieldsList" style="max-height: 150px; overflow-y: auto; margin-bottom: 20px;">
                    <div style="text-align: center; color: #999; padding: 15px; font-size: 12px;">×˜×¨× × ×•×¡×¤×•</div>
                </div>
                
                <div class="panel-title">ğŸ“ ×¤×¨×˜×™×</div>
                
                <div class="form-group">
                    <label class="form-label">×©× ××¡××š *</label>
                    <input type="text" class="form-input" id="docName" placeholder="×—×•×–×”">
                </div>
                
                <div class="form-group">
                    <label class="form-label">×©× × ××¢×Ÿ *</label>
                    <input type="text" class="form-input" id="recipientName" placeholder="×™×©×¨××œ ×›×”×Ÿ">
                </div>
                
                <div class="form-group">
                    <label class="form-label">××™×™×œ × ××¢×Ÿ</label>
                    <input type="email" class="form-input" id="recipientEmail" placeholder="email@example.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">ğŸ“± WhatsApp × ××¢×Ÿ</label>
                    <input type="tel" class="form-input" id="recipientPhone" placeholder="0501234567">
                </div>
                
                <button class="btn btn-primary btn-block" onclick="createSignatureLink()" style="margin-top: 20px;">
                    ğŸ”— ×¦×•×¨ ×§×™×©×•×¨ ×œ×—×ª×™××”
                </button>
                
                <!-- âœ… 3 ×›×¤×ª×•×¨×™× ×›××• ×‘×ª××•× ×” -->
                <div id="sendOptions" class="hidden" style="margin-top: 20px;">
                    <div class="panel-title">×©×œ×—</div>
                    
                    <div class="send-buttons">
                        <button class="btn btn-success" onclick="sendEmail()">
                            ğŸ“§ ××™×™×œ
                        </button>
                        <button class="btn btn-whatsapp" onclick="sendWhatsApp()">
                            ğŸ“± WA
                        </button>
                        <button class="btn btn-primary" onclick="copyLink()">
                            ğŸ“‹ ×”×¢×ª×§
                        </button>
                    </div>
                    
                    <div class="link-box">
                        <div class="link-label">ğŸ”— ×§×™×©×•×¨ ×œ×—×ª×™××”:</div>
                        <input type="text" id="generatedLink" readonly class="form-input" style="font-size: 10px; cursor: pointer;" onclick="this.select()">
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        let pdfDoc = null;
        let currentPage = 1;
        let totalPages = 0;
        let scale = 2.0;
        let pdfFileName = '';
        let selectedFieldType = null;
        let fields = [];
        let fieldIdCounter = 1;
        let pdfImages = [];
        
        const fieldTypes = {
            signature: { name: '×—×ª×™××”', icon: 'âœï¸', color: '#D4AF37' },
            name: { name: '×©× ××œ×', icon: 'ğŸ‘¤', color: '#2ECC71' },
            email: { name: '××™×™×œ', icon: 'ğŸ“§', color: '#FF9800' },
            phone: { name: '×˜×œ×¤×•×Ÿ', icon: 'ğŸ“±', color: '#9C27B0' },
            idNumber: { name: '×ª.×–', icon: 'ğŸ†”', color: '#E74C3C' },
            date: { name: '×ª××¨×™×š', icon: 'ğŸ“…', color: '#2196F3' },
            custom: { name: '×˜×§×¡×˜ ×—×•×¤×©×™', icon: 'ğŸ“', color: '#607D8B' }
        };
        
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        
        uploadZone.addEventListener('click', () => fileInput.click());
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.style.borderColor = '#2ECC71';
        });
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.style.borderColor = '#D4AF37';
        });
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.style.borderColor = '#D4AF37';
            if (e.dataTransfer.files[0]) handleFileUpload(e.dataTransfer.files[0]);
        });
        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) handleFileUpload(e.target.files[0]);
        });
        
        async function handleFileUpload(file) {
            if (file.type !== 'application/pdf') {
                alert('âŒ PDF ×‘×œ×‘×“');
                return;
            }
            
            pdfFileName = file.name;
            
            try {
                const arrayBuffer = await file.arrayBuffer();
                pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                totalPages = pdfDoc.numPages;
                
                pdfImages = [];
                for (let i = 1; i <= totalPages; i++) {
                    const imageData = await convertPageToImage(i);
                    pdfImages.push(imageData);
                }
                
                document.getElementById('uploadZone').style.display = 'none';
                document.getElementById('pdfViewer').style.display = 'block';
                document.getElementById('fileName').textContent = pdfFileName;
                document.getElementById('totalPages').textContent = totalPages;
                
                displayPage(currentPage);
            } catch (error) {
                alert('×©×’×™××”: ' + error.message);
            }
        }
        
        async function convertPageToImage(pageNum) {
            const page = await pdfDoc.getPage(pageNum);
            const viewport = page.getViewport({ scale: scale });
            
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            
            await page.render({ canvasContext: context, viewport: viewport }).promise;
            
            return canvas.toDataURL('image/png');
        }
        
        function displayPage(pageNum) {
            const img = document.getElementById('pdfImage');
            img.src = pdfImages[pageNum - 1];
            
            currentPage = pageNum;
            document.getElementById('pageNum').textContent = pageNum;
            document.getElementById('prevBtn').disabled = (pageNum <= 1);
            document.getElementById('nextBtn').disabled = (pageNum >= totalPages);
            
            redrawAllFields();
        }
        
        function previousPage() {
            if (currentPage > 1) displayPage(currentPage - 1);
        }
        
        function nextPage() {
            if (currentPage < totalPages) displayPage(currentPage + 1);
        }
        
        document.querySelectorAll('.field-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.field-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedFieldType = btn.getAttribute('data-field');
            });
        });
        
        document.getElementById('pdfImage').addEventListener('click', (e) => {
            if (!selectedFieldType) {
                alert('âš ï¸ ×‘×—×¨ ×¡×•×’ ×©×“×”');
                return;
            }
            
            const img = e.target;
            const rect = img.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const fieldInfo = fieldTypes[selectedFieldType];
            let fieldName = fieldInfo.name;
            
            if (selectedFieldType === 'custom') {
                fieldName = prompt('×”×–×Ÿ ×©× ×œ×©×“×”:', '×©×“×” ××•×ª××') || fieldName;
            }
            
            const field = {
                id: fieldIdCounter++,
                type: selectedFieldType,
                name: fieldName,
                icon: fieldInfo.icon,
                color: fieldInfo.color,
                x: x,
                y: y,
                width: 180,
                height: 40,
                page: currentPage
            };
            
            fields.push(field);
            drawFieldMarker(field);
            updateFieldsList();
            
            document.querySelectorAll('.field-btn').forEach(b => b.classList.remove('active'));
            selectedFieldType = null;
        });
        
        function drawFieldMarker(field) {
            const container = document.getElementById('imageContainer');
            
            const marker = document.createElement('div');
            marker.className = 'field-marker';
            marker.style.borderColor = field.color;
            marker.style.left = field.x + 'px';
            marker.style.top = field.y + 'px';
            marker.style.width = field.width + 'px';
            marker.style.height = field.height + 'px';
            marker.textContent = `${field.icon} ${field.name}`;
            marker.setAttribute('data-field-id', field.id);
            
            const resizeHandle = document.createElement('div');
            resizeHandle.className = 'resize-handle';
            marker.appendChild(resizeHandle);
            
            let isDragging = false;
            let dragOffsetX = 0;
            let dragOffsetY = 0;
            
            marker.addEventListener('mousedown', (e) => {
                if (e.target.classList.contains('resize-handle')) return;
                isDragging = true;
                dragOffsetX = e.clientX - marker.offsetLeft;
                dragOffsetY = e.clientY - marker.offsetTop;
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                marker.style.left = (e.clientX - dragOffsetX) + 'px';
                marker.style.top = (e.clientY - dragOffsetY) + 'px';
                field.x = e.clientX - dragOffsetX;
                field.y = e.clientY - dragOffsetY;
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            let isResizing = false;
            resizeHandle.addEventListener('mousedown', (e) => {
                e.stopPropagation();
                isResizing = true;
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                const rect = marker.getBoundingClientRect();
                const newWidth = e.clientX - rect.left;
                const newHeight = e.clientY - rect.top;
                if (newWidth > 50 && newHeight > 30) {
                    marker.style.width = newWidth + 'px';
                    marker.style.height = newHeight + 'px';
                    field.width = newWidth;
                    field.height = newHeight;
                }
            });
            
            document.addEventListener('mouseup', () => {
                isResizing = false;
            });
            
            container.appendChild(marker);
        }
        
        function redrawAllFields() {
            document.querySelectorAll('.field-marker').forEach(m => m.remove());
            fields.filter(f => f.page === currentPage).forEach(drawFieldMarker);
        }
        
        function updateFieldsList() {
            const list = document.getElementById('fieldsList');
            document.getElementById('fieldCount').textContent = fields.length;
            
            if (fields.length === 0) {
                list.innerHTML = '<div style="text-align: center; color: #999; padding: 15px; font-size: 12px;">×˜×¨× × ×•×¡×¤×•</div>';
                return;
            }
            
            list.innerHTML = fields.map(f => `
                <div style="background: #f9f9f9; border: 1px solid #ddd; border-radius: 6px; padding: 8px; margin-bottom: 6px; display: flex; justify-content: space-between; font-size: 12px;">
                    <div>
                        <div style="font-weight: 700;">${f.icon} ${f.name}</div>
                        <div style="font-size: 10px; color: #666;">×¢××•×“ ${f.page}</div>
                    </div>
                    <button onclick="deleteField(${f.id})" style="background: #E74C3C; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">ğŸ—‘ï¸</button>
                </div>
            `).join('');
        }
        
        function deleteField(id) {
            fields = fields.filter(f => f.id !== id);
            document.querySelector(`[data-field-id="${id}"]`)?.remove();
            updateFieldsList();
        }
        
        function removeFile() {
            if (confirm('××—×§ ×§×•×‘×¥?')) {
                pdfDoc = null;
                pdfImages = [];
                document.getElementById('pdfViewer').style.display = 'none';
                document.getElementById('uploadZone').style.display = 'block';
                fileInput.value = '';
            }
        }
        
        function createSignatureLink() {
            if (!pdfDoc) {
                alert('âŒ ×”×¢×œ×” PDF');
                return;
            }
            if (fields.length === 0) {
                alert('âŒ ×”×•×¡×£ ×©×“×•×ª');
                return;
            }
            
            const docName = document.getElementById('docName').value;
            const recipientName = document.getElementById('recipientName').value;
            
            if (!docName || !recipientName) {
                alert('âŒ ××œ× ×©× ××¡××š ×•× ××¢×Ÿ');
                return;
            }
            
            const data = {
                documentId: 'DOC-' + Date.now(),
                documentName: docName,
                fileName: pdfFileName,
                pdfImages: pdfImages,
                recipientName: recipientName,
                recipientEmail: document.getElementById('recipientEmail').value,
                recipientPhone: document.getElementById('recipientPhone').value,
                fields: fields,
                createdAt: new Date().toISOString()
            };
            
            const encrypted = btoa(encodeURIComponent(JSON.stringify(data)));
            const baseURL = window.location.href.split('/').slice(0, -1).join('/') + '/';
            const signatureURL = `${baseURL}signature-page.html?doc=${encrypted}`;
            
            document.getElementById('generatedLink').value = signatureURL;
            document.getElementById('sendOptions').classList.remove('hidden');
            
            navigator.clipboard.writeText(signatureURL);
            alert('âœ… ×§×™×©×•×¨ × ×•×¦×¨ ×•×”×•×¢×ª×§!');
        }
        
        // âœ… 3 ×¤×•× ×§×¦×™×•×ª ×©×œ×™×—×”
        function copyLink() {
            const link = document.getElementById('generatedLink').value;
            navigator.clipboard.writeText(link);
            alert('âœ… ×”×§×™×©×•×¨ ×”×•×¢×ª×§ ×œ×œ×•×—!\n\nğŸ“‹ ×¢×›×©×™×• ××¤×©×¨ ×œ×”×“×‘×™×§ ××•×ª×• ×‘×›×œ ××§×•×');
        }
        
        function sendWhatsApp() {
            const link = document.getElementById('generatedLink').value;
            const name = document.getElementById('recipientName').value;
            const doc = document.getElementById('docName').value;
            const phone = document.getElementById('recipientPhone').value;
            
            const msg = `×©×œ×•× ${name},\n\n×§×™×‘×œ×ª ××¡××š ×œ×—×ª×™××”: "${doc}"\n\n×œ×—×ª×™××” ×œ×—×¥ ×›××Ÿ:\n${link}\n\n×‘×‘×¨×›×”,\n×–×¨×™××” ×¤×œ×•×¡`;
            
            if (phone) {
                let normalizedPhone = phone.replace(/[-\s()]/g, '');
                if (normalizedPhone.startsWith('0')) {
                    normalizedPhone = '972' + normalizedPhone.substring(1);
                }
                if (!normalizedPhone.startsWith('+')) {
                    normalizedPhone = '+' + normalizedPhone;
                }
                window.open(`https://wa.me/${normalizedPhone}?text=${encodeURIComponent(msg)}`, '_blank');
                setTimeout(() => alert('âœ… WhatsApp × ×¤×ª×—!\n\nğŸ“± ×”×”×•×“×¢×” ××•×›× ×” ×¢×‘×•×¨: ' + phone), 500);
            } else {
                window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
                setTimeout(() => alert('âœ… WhatsApp × ×¤×ª×—!\n\nğŸ’¡ ×‘×—×¨ ××™×© ×§×©×¨ ×•×©×œ×—'), 500);
            }
        }
        
        function sendEmail() {
            const link = document.getElementById('generatedLink').value;
            const email = document.getElementById('recipientEmail').value;
            const name = document.getElementById('recipientName').value;
            const doc = document.getElementById('docName').value;
            
            if (!email) {
                alert('âŒ ×× × ×”×–×Ÿ ×›×ª×•×‘×ª ××™×™×œ ×©×œ ×”× ××¢×Ÿ');
                return;
            }
            
            const subj = encodeURIComponent(`×–×¨×™××” ×¤×œ×•×¡ - ×—×ª×™××”: ${doc}`);
            const body = encodeURIComponent(`×©×œ×•× ${name},\n\n×§×™×‘×œ×ª ××¡××š ×œ×—×ª×™××”: "${doc}"\n\n×œ×—×ª×™××” ×œ×—×¥ ×¢×œ ×”×§×™×©×•×¨:\n${link}\n\n×‘×‘×¨×›×”,\n×–×¨×™××” ×¤×œ×•×¡`);
            
            window.location.href = `mailto:${email}?subject=${subj}&body=${body}`;
            setTimeout(() => alert('âœ… ×ª×•×›× ×ª ×”××™×™×œ × ×¤×ª×—×”!\n\nğŸ“§ ××™×™×œ ××•×›×Ÿ ×¢×‘×•×¨: ' + email), 500);
        }
    </script>
</body>
</html>
